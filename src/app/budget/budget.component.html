<div class='container'>
  <div class='row top'>
    <div class='title col-md-3'>
      <h1>Budget</h1>
    </div>
    <div class='col-md-3'>
      <button type="button" class="btn btn-primary" (click)="open(content)">New Budget Category</button>
    </div>
    <div class='col-md-3 d-inline-block' ngbDropdown>
      <button class='btn btn-outline-primary' id='dropdownInterval' ngbDropdownToggle>Set Interval</button>
      <div ngbDropdownMenu aria-labelledby='dropdownInterval'>
        <button class='dropdown-item' (click)="setInterval('Daily')">Daily</button>
        <button class='dropdown-item' (click)="setInterval('Weekly')">Weekly</button>
        <button class='dropdown-item' (click)="setInterval('Monthly')">Monthly</button>
        <button class='dropdown-item' (click)="setInterval('Yearly')">Yearly</button>        
      </div>
    </div>
    <div class='calendar col-md-3'>
      <app-day-calendar></app-day-calendar>
    </div>
  </div>
  <div class='row header'>
    <div class='category col-lg-3'>Category</div>
    <div class='budgeted col-lg-3'>Amount Budgeted ({{interval}})</div>
    <div class='spent col-lg-3'>Amount Spent</div>
    <div class='percentage col-lg-2'>Percentage Spent</div>
    <div class='col-lg-1'></div>
  </div>
  <div *ngFor="let entry of budgetEntries" class='row content'>
    <div class='col-lg-3'>{{entry.name}}</div>
    <div class='col-lg-3'>${{entry.amount | number: '1.0-2'}}</div>
    <div *ngIf='purchaseCategoryTotals[entry.name]' class='col-lg-3'>${{purchaseCategoryTotals[entry.name] | number:'1.0-2'}}</div>
    <div *ngIf='!purchaseCategoryTotals[entry.name]' class='col-lg-3'>$0</div>
    <div class='col-lg-2'>{{purchaseCategoryTotals[entry.name]/entry.amount | percent}}</div>
    <div class='col-lg-1'>
      <i class="fa fa-lg fa-edit update float-left" (click)="open(patchModal, entry)"></i>
      <i class="fa fa-lg fa-times-circle delete float-right" (click)='deleteCategory(entry.id)'></i>
    </div>
  </div>
</div>

<ng-template #content let-c="close">
  <app-message></app-message>
  <div class="modal-header">
    <h4 class="modal-title">Enter New Budget Category</h4>
    <button type="button" class="close" aria-label="Close" (click)="c()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="budgetform" (ngSubmit)="onNewCategory()">
      <div class='form-group' [ngClass]="{
        'has-danger': name.invalid && (name.dirty || name.touched),
        'has-success': name.valid && (name.dirty || name.touched)
      }">
        <label>Category Name</label>
        <input type='text' class='form-control' formControlName='name' placeholder='Enter Category Name' required>
        <div *ngIf="name.errors && (name.dirty || name.touched)">
          <p *ngIf="name.errors.required">Purchase name is required</p>
        </div>
      </div>
      <div class='form-group'>
        <label>Amount to Budget</label>
        <input type='number' class='form-control' formControlName='amount' placeholder='Enter Amount'>
      </div>
      <div class='form-group'>
        <label>Interval for Amount Budgeted</label>
        <select class='form-control' formControlName='interval'>
          <option [ngValue]='null'>Select Interval</option>
          <option>Daily</option>
          <option>Weekly</option>
          <option>Monthly</option>
          <option>Yearly</option>
        </select>
      </div>
      <div class="modal-footer">
        <input type='submit' class='btn btn-primary' value='Submit'>
        <button type="button" class="btn btn-outline-dark" (click)="c()">Close</button>
      </div>
    </form>
  </div>

</ng-template>

<ng-template #patchModal let-c="close">
  <div class="modal-header">
    <h4 class="modal-title">Edit Budget Category</h4>
    <button type="button" class="close" aria-label="Close" (click)="c()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="budgetform" (ngSubmit)="onUpdateCategory()">
      <div class='form-group'>
        <label>Category Name</label>
        <input type='text' class='form-control' formControlName='name' [(ngModel)]='this.formData.name'>
      </div>
      <div class='form-group'>
        <label>Amount to Budget</label>
        <input type='number' class='form-control' formControlName='amount' [(ngModel)]='this.formData.amount'>
      </div>
      <div class='form-group'>
        <label>Interval for Amount Budgeted</label>
        <select class='form-control' formControlName='interval'>
          <option [ngValue]='null'>Select Interval</option>
          <option>Daily</option>
          <option>Weekly</option>
          <option>Monthly</option>
          <option>Yearly</option>
        </select>
      </div>
      <div class="modal-footer">
        <input type='submit' class='btn btn-primary' value='Submit'>
        <button type="button" class="btn btn-outline-dark" (click)="c()">Close</button>
      </div>
    </form>
  </div>

</ng-template>